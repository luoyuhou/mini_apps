<!--pages/refund/index.wxml-->
<view class="refund-page">
    <!-- Tab æ  -->
    <view class="tab-bar">
        <view 
            wx:for="{{tabs}}" 
            wx:key="status" 
            class="tab-item {{currentStatus === item.status ? 'active' : ''}}"
            bindtap="onTabChange"
            data-status="{{item.status}}"
        >
            <text class="tab-text">{{item.name}}</text>
            <view class="tab-underline" wx:if="{{currentStatus === item.status}}"></view>
        </view>
    </view>

    <!-- é€€æ¬¾åˆ—è¡¨ -->
    <scroll-view class="refund-scroll" scroll-y enable-back-to-top>
        <view class="refund-list">
            <view class="refund-card" wx:for="{{refundList}}" wx:key="refund_id" bindtap="onViewDetail" data-id="{{item.refund_id}}">
                <!-- é€€æ¬¾å¤´éƒ¨ -->
                <view class="refund-header">
                    <view class="refund-info">
                        <text class="refund-id">é€€æ¬¾å•å·: {{item.refund_id}}</text>
                    </view>
                    <view class="refund-status" style="color: {{statusConfig[item.state].color}}">
                        {{statusConfig[item.state].text}}
                    </view>
                </view>

                <!-- å•†å“ä¿¡æ¯ -->
                <view class="goods-info" wx:if="{{item.goods_info}}">
                    <view class="goods-name">{{item.goods_info.goods_name}}</view>
                    <view class="goods-spec">{{item.goods_info.unit_name}} x {{item.goods_info.count}}</view>
                </view>

                <!-- é€€æ¬¾ä¿¡æ¯ -->
                <view class="refund-details">
                    <view class="detail-row">
                        <text class="detail-label">é€€æ¬¾é‡‘é¢:</text>
                        <text class="detail-value amount">Â¥{{item.money / 100}}</text>
                    </view>
                    <view class="detail-row" wx:if="{{item.reason}}">
                        <text class="detail-label">é€€æ¬¾åŸå› :</text>
                        <text class="detail-value">{{item.reason}}</text>
                    </view>
                    <view class="detail-row">
                        <text class="detail-label">ç”³è¯·æ—¶é—´:</text>
                        <text class="detail-value">{{item.createtime}}</text>
                    </view>
                </view>

                <!-- æ“ä½œæŒ‰é’® -->
                <view class="refund-actions" catchtap="stopPropagation">
                    <button 
                        wx:if="{{item.state === 0}}"
                        class="btn-cancel" 
                        catchtap="onCancelRefund"
                        data-id="{{item.refund_id}}"
                    >å–æ¶ˆé€€æ¬¾</button>
                    
                    <button 
                        wx:if="{{item.state === 0}}"
                        class="btn-primary" 
                        catchtap="onUrgeRefund"
                        data-id="{{item.refund_id}}"
                    >å‚¬ä¿ƒé€€æ¬¾</button>
                </view>
            </view>
        </view>

        <!-- åŠ è½½çŠ¶æ€ -->
        <view class="loading-status" wx:if="{{loading}}">
            <text>åŠ è½½ä¸­...</text>
        </view>

        <!-- ç©ºçŠ¶æ€ -->
        <view class="empty-state" wx:if="{{!loading && refundList.length === 0}}">
            <text class="empty-icon">ğŸ’°</text>
            <text class="empty-text">æš‚æ— é€€æ¬¾è®°å½•</text>
            <text class="empty-hint">å½“å‰æ²¡æœ‰é€€æ¬¾/å”®åè®¢å•</text>
        </view>

        <!-- æ²¡æœ‰æ›´å¤š -->
        <view class="no-more" wx:if="{{!loading && !hasMore && refundList.length > 0}}">
            <text>â€” æ²¡æœ‰æ›´å¤šäº† â€”</text>
        </view>
    </scroll-view>
</view>
