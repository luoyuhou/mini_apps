<!--pages/order-list/order-list.wxml-->
<wxs src="../../utils/filter.wxs" module="filter" />
<view class="order-list-page">
    <!-- Tab æ  -->
    <view class="tab-bar">
        <view 
            wx:for="{{tabs}}" 
            wx:key="status" 
            class="tab-item {{currentStatus === item.status ? 'active' : ''}}"
            bindtap="onTabChange"
            data-status="{{item.status}}"
        >
            <text class="tab-text">{{item.name}}</text>
            <view class="tab-underline" wx:if="{{currentStatus === item.status}}"></view>
        </view>
    </view>

    <!-- è®¢å•åˆ—è¡¨ -->
    <scroll-view class="order-scroll" scroll-y enable-back-to-top>
        <view class="order-list">
            <view class="order-card" wx:for="{{orderList}}" wx:key="order_id">
                <!-- è®¢å•å¤´éƒ¨ -->
                <view class="order-header">
                    <view class="store-info">
                        <text class="store-name">{{item._store.store_name || 'å•†å®¶'}}</text>
                    </view>
                    <view class="order-status" style="color: {{statusConfig[item.status].color}}">
                        {{statusConfig[item.status].text}}
                    </view>
                </view>

                <!-- å•†å“åˆ—è¡¨ -->
                <view class="goods-list" bindtap="onViewDetail" data-id="{{item.order_id}}">
                    <view class="goods-item" wx:for="{{item.items}}" wx:key="goods_id" wx:for-item="goods">
                        <view class="goods-info">
                            <view class="goods-name">{{goods.goods_name}}</view>
                            <view class="goods-spec">{{goods.unit_name}}</view>
                        </view>
                        <view class="goods-price-count">
                            <text class="goods-price">Â¥{{goods.price / 100}}</text>
                            <text class="goods-count">x{{goods.count}}</text>
                        </view>
                    </view>
                </view>

                <!-- é…é€ä¿¡æ¯ -->
                <view class="delivery-info">
                    <text class="delivery-label">é€è¾¾æ—¶é—´ï¼š</text>
                    <text class="delivery-time">{{item.delivery_date}}</text>
                </view>

                <!-- æ”¶è´§åœ°å€ -->
                <view class="address-info">
                    <text class="address-icon">æ”¶è´§åœ°å€ï¼š</text>
                    <text class="address-text">{{item.province}}{{item.city}}{{item.area}}{{item.town}}{{item.address}}</text>
                </view>
                <view class="address-info">
                    <text class="address-icon">ğŸ“</text>
                    <text class="address-text">{{item.recipient}} {{item.phone}}</text>
                </view>

                <!-- è®¢å•é‡‘é¢ -->
                <view class="order-amount">
                    <text class="amount-label">å…±{{item.total_count}}ä»¶å•†å“</text>
                    <text class="amount-text">åˆè®¡: </text>
                    <text class="amount-value">Â¥{{item.money / 100}}</text>
                </view>

                <!-- æ“ä½œæŒ‰é’® -->
                <view class="order-actions">
                    <view class="order-time">{{item.create_time}}</view>
                    <view class="action-buttons">
                        <!-- å–æ¶ˆè®¢å•æŒ‰é’®ï¼ˆå¾…ä»˜æ¬¾æ—¶æ˜¾ç¤ºï¼‰ -->
                        <button 
                            wx:if="{{item.status === '0'}}"
                            class="btn-cancel" 
                            bindtap="onCancelOrder"
                            data-id="{{item.order_id}}"
                        >å–æ¶ˆè®¢å•</button>
                        
                        <!-- ä¸»æ“ä½œæŒ‰é’® -->
                        <button 
                            class="btn-primary" 
                            bindtap="onOrderAction"
                            data-id="{{item.order_id}}"
                            data-status="{{item.status}}"
                        >{{statusConfig[item.status].action}}</button>
                    </view>
                </view>
            </view>
        </view>

        <!-- åŠ è½½çŠ¶æ€ -->
        <view class="loading-status" wx:if="{{loading}}">
            <text>åŠ è½½ä¸­...</text>
        </view>

        <!-- ç©ºçŠ¶æ€ -->
        <view class="empty-state" wx:if="{{!loading && orderList.length === 0}}">
            <text class="empty-icon">ğŸ“¦</text>
            <text class="empty-text">æš‚æ— è®¢å•</text>
            <text class="empty-hint">å¿«å»æŒ‘é€‰å¿ƒä»ªçš„å•†å“å§ï½</text>
        </view>

        <!-- æ²¡æœ‰æ›´å¤š -->
        <view class="no-more" wx:if="{{!loading && !hasMore && orderList.length > 0}}">
            <text>â€” æ²¡æœ‰æ›´å¤šäº† â€”</text>
        </view>
    </scroll-view>
</view>
